// script.js

const apiKey = '1cfeff56cf21c5dc76845893e03c8ddc';  // Sostituisci con la tua chiave API di OpenWeather
const city = 'Lucca';           // Puoi cambiare la città qui

// URL dell'API di OpenWeather
const currentWeatherUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=it`;
const hourlyWeatherUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=it`;
const dailyWeatherUrl = `https://api.openweathermap.org/data/2.5/forecast/daily?q=${city}&appid=${apiKey}&units=metric&lang=it&cnt=5`;

// Funzione per caricare i dati meteo attuali
fetch(currentWeatherUrl)
    .then(response => response.json())
    .then(data => {
        const cityElement = document.getElementById('city');
        const temperatureElement = document.getElementById('temperature');
        const descriptionElement = document.getElementById('description');

        const cityName = data.name;
        const temperature = data.main.temp;
        const description = data.weather[0].description;

        cityElement.textContent = cityName;
        temperatureElement.textContent = `${temperature} °C`;
        descriptionElement.textContent = description.charAt(0).toUpperCase() + description.slice(1);
    })
    .catch(error => console.error('Errore nel recuperare i dati meteo attuali:', error));

// Funzione per caricare le previsioni meteo per le prossime 5 ore
fetch(hourlyWeatherUrl)
    .then(response => response.json())
    .then(data => {
        const hourlyDataElement = document.getElementById('hourly-data');
        hourlyDataElement.innerHTML = '';  // Svuota prima di aggiungere nuovi dati

        const hourlyForecast = data.list.slice(0, 5);  // Prendi solo le prime 5 ore
        hourlyForecast.forEach(item => {
            const hour = new Date(item.dt * 1000).getHours();
            const temp = item.main.temp;
            const desc = item.weather[0].description;

            const div = document.createElement('div');
            div.classList.add('weather-info');
            div.innerHTML = `<strong>${hour}:00</strong><br>${temp}°C<br>${desc}`;
            hourlyDataElement.appendChild(div);
        });
    })
    .catch(error => console.error('Errore nel recuperare le previsioni orarie:', error));

// Funzione per caricare le previsioni meteo per i prossimi 5 giorni
fetch(dailyWeatherUrl)
    .then(response => response.json())
    .then(data => {
        const dailyDataElement = document.getElementById('daily-data');
        dailyDataElement.innerHTML = '';  // Svuota prima di aggiungere nuovi dati

        const dailyForecast = data.list;
        dailyForecast.forEach(item => {
            const day = new Date(item.dt * 1000).toLocaleDateString('it-IT', { weekday: 'short' });
            const tempMin = item.temp.min;
            const tempMax = item.temp.max;
            const desc = item.weather[0].description;

            const div = document.createElement('div');
            div.classList.add('weather-info');
            div.innerHTML = `${day}<br>${tempMin}°C - ${tempMax}°C<br>${desc}`;
            dailyDataElement.appendChild(div);
        });
    })
    .catch(error => console.error('Errore nel recuperare le previsioni giornaliere:', error));

// Funzione per gestire lo swipe
let currentIndex = 0;
const swipeContainer = document.getElementById('swipe-container');

// Gestire lo swipe orizzontale
swipeContainer.addEventListener('touchstart', handleTouchStart, false);
swipeContainer.addEventListener('touchmove', handleTouchMove, false);

let startX = 0;
let dist = 0;

function handleTouchStart(e) {
    startX = e.touches[0].clientX;
}

function handleTouchMove(e) {
    const touchMove = e.touches[0].clientX;
    dist = touchMove - startX;
    if (Math.abs(dist) > 50) {
        if (dist > 0 && currentIndex > 0) {
            currentIndex--;
        } else if (dist < 0 && currentIndex < 2) {
            currentIndex++;
        }
        updateView();
        startX = touchMove; // Reset the touch start position
    }
}

function updateView() {
    swipeContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
}
